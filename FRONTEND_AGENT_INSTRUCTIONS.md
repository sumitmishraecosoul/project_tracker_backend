# Frontend Agent Instructions - Project Tracker API Updates

## Overview
The backend API has been significantly enhanced with new endpoints, improved data consistency, better error handling, and comprehensive team member management features. This document outlines all changes that need to be implemented on the frontend side.

## 1. New Dashboard API Endpoint

### GET /api/dashboard/summary
**Purpose:** Single endpoint for comprehensive dashboard data (replaces multiple API calls)

**Request:**
```
GET /api/dashboard/summary
Authorization: Bearer <token>
```

**Response:**
```json
{
  "activeProjectsCount": 2,
  "totalTasksCount": 6,
  "inProgressTasksCount": 2,
  "completedTasksCount": 3,
  "totalTeamMembersCount": 5,
  "recentProjects": [
    {
      "_id": "507f1f77bcf86cd799439031",
      "title": "E-commerce Website Development",
      "description": "Complete online store with payment integration",
      "status": "Active",
      "updatedAt": "2024-12-01T10:00:00.000Z"
    }
  ],
  "taskProgress": {
    "completed": 3,
    "inProgress": 2,
    "total": 6
  },
  "totalProjectsCount": 3,
  "pendingTasksCount": 1,
  "overdueTasksCount": 0
}
```

**Frontend Implementation:**
- Replace multiple dashboard API calls with this single endpoint
- Update dashboard components to use the new response structure
- Display all metrics: project counts, task counts, team member count, recent projects, and progress summary

## 2. Enhanced Project Management APIs

### New Team Member Management Endpoints

#### Add Team Member
```
POST /api/projects/{projectId}/team-members
Authorization: Bearer <token>
Content-Type: application/json

{
  "userId": "507f1f77bcf86cd799439031",
  "role": "developer"
}
```

#### Remove Team Member
```
DELETE /api/projects/{projectId}/team-members/{userId}
Authorization: Bearer <token>
```

#### Update Team Member Role
```
PUT /api/projects/{projectId}/team-members/{userId}
Authorization: Bearer <token>
Content-Type: application/json

{
  "role": "lead"
}
```

#### Bulk Add Team Members
```
POST /api/projects/{projectId}/team-members/bulk
Authorization: Bearer <token>
Content-Type: application/json

{
  "teamMembers": [
    {
      "userId": "507f1f77bcf86cd799439031",
      "role": "developer"
    },
    {
      "userId": "507f1f77bcf86cd799439032",
      "role": "tester"
    }
  ]
}
```

### Enhanced Project APIs

#### Create Project (Enhanced)
```
POST /api/projects
Authorization: Bearer <token>
Content-Type: application/json

{
  "title": "New Project",
  "description": "Project description",
  "status": "Active",
  "priority": "High",
  "assignedTo": ["507f1f77bcf86cd799439031"],
  "teamMembers": [
    {
      "user": "507f1f77bcf86cd799439031",
      "role": "developer"
    }
  ]
}
```

#### Update Project (Enhanced)
```
PUT /api/projects/{projectId}
Authorization: Bearer <token>
Content-Type: application/json

{
  "title": "Updated Project",
  "description": "Updated description",
  "status": "Active",
  "priority": "Medium",
  "assignedTo": ["507f1f77bcf86cd799439031"],
  "teamMembers": [
    {
      "user": "507f1f77bcf86cd799439031",
      "role": "lead"
    }
  ]
}
```

**Frontend Implementation:**
- Add team member management UI components
- Implement role-based permissions (only project creator/admin can manage team members)
- Add bulk team member addition functionality
- Update project creation/editing forms to include team member management
- Display team members with their roles in project details

## 3. New Project Tasks Endpoint

### GET /api/projects/{projectId}/tasks
**Purpose:** Get all tasks for a specific project

**Request:**
```
GET /api/projects/{projectId}/tasks
Authorization: Bearer <token>
```

**Response:**
```json
[
  {
    "_id": "507f1f77bcf86cd799439031",
    "id": "TASK-0001",
    "projectId": "507f1f77bcf86cd799439031",
    "task": "Implement user authentication",
    "description": "Add JWT-based authentication",
    "status": "In Progress",
    "priority": "High",
    "assignedTo": {
      "_id": "507f1f77bcf86cd799439031",
      "name": "John Doe",
      "email": "john@example.com"
    },
    "reporter": {
      "_id": "507f1f77bcf86cd799439032",
      "name": "Jane Smith",
      "email": "jane@example.com"
    },
    "eta": "2024-12-15T00:00:00.000Z",
    "createdAt": "2024-12-01T10:00:00.000Z",
    "updatedAt": "2024-12-01T10:00:00.000Z"
  }
]
```

**Frontend Implementation:**
- Add project detail page that displays all associated tasks
- Use this endpoint when users click on a project from the project list
- Display tasks with populated user information (assignedTo and reporter)

## 4. Enhanced Task Management

### Task Creation (Updated)
**Important:** Task IDs are now auto-generated by the backend

**Request:**
```
POST /api/tasks
Authorization: Bearer <token>
Content-Type: application/json

{
  "projectId": "507f1f77bcf86cd799439031",
  "task": "New task title",
  "description": "Task description",
  "status": "To Do",
  "priority": "Medium",
  "assignedTo": "507f1f77bcf86cd799439031",  // User ID only
  "reporter": "507f1f77bcf86cd799439032",    // User ID only
  "eta": "2024-12-15T00:00:00.000Z"
}
```

**Response:**
```json
{
  "_id": "507f1f77bcf86cd799439031",
  "id": "TASK-0007",  // Auto-generated
  "projectId": "507f1f77bcf86cd799439031",
  "task": "New task title",
  "description": "Task description",
  "status": "To Do",
  "priority": "Medium",
  "assignedTo": {
    "_id": "507f1f77bcf86cd799439031",
    "name": "John Doe",
    "email": "john@example.com"
  },
  "reporter": {
    "_id": "507f1f77bcf86cd799439032",
    "name": "Jane Smith",
    "email": "jane@example.com"
  },
  "eta": "2024-12-15T00:00:00.000Z",
  "createdAt": "2024-12-01T10:00:00.000Z",
  "updatedAt": "2024-12-01T10:00:00.000Z"
}
```

### Task Operations (Critical Update)
**Important:** For GET, PUT, and DELETE operations on tasks, use the MongoDB `_id` field, NOT the custom `id` field.

**Correct Usage:**
```
GET /api/tasks/507f1f77bcf86cd799439031    // Use _id
PUT /api/tasks/507f1f77bcf86cd799439031    // Use _id
DELETE /api/tasks/507f1f77bcf86cd799439031 // Use _id
```

**Incorrect Usage:**
```
GET /api/tasks/TASK-0001    // Don't use custom id
PUT /api/tasks/TASK-0001    // Don't use custom id
DELETE /api/tasks/TASK-0001 // Don't use custom id
```

**Frontend Implementation:**
- Remove `id` field from task creation forms (backend auto-generates)
- Update task edit/delete operations to use `_id` instead of custom `id`
- Ensure assignedTo and reporter fields accept user IDs only
- Display populated user information (name, email) for assignedTo and reporter

## 5. Enhanced User Management

### Get All Users (Updated Response Format)
**Request:**
```
GET /api/users
Authorization: Bearer <token>
```

**Response:**
```json
[
  {
    "_id": "507f1f77bcf86cd799439031",
    "name": "John Doe",
    "email": "john@example.com",
    "role": "user",
    "createdAt": "2024-12-01T10:00:00.000Z",
    "updatedAt": "2024-12-01T10:00:00.000Z"
  }
]
```

**Frontend Implementation:**
- Update user list components to handle array response
- Remove password field handling (backend excludes it)

## 6. Error Handling Updates

### New Error Response Format
All endpoints now return consistent error responses:

```json
{
  "error": "Error Type",
  "message": "Detailed error message"
}
```

### Common Error Status Codes
- 400: Bad Request (validation errors)
- 401: Unauthorized (missing/invalid token)
- 403: Forbidden (insufficient permissions)
- 404: Not Found (resource doesn't exist)
- 409: Conflict (duplicate data)
- 500: Internal Server Error

**Frontend Implementation:**
- Update error handling to use the new response format
- Display user-friendly error messages
- Handle authentication errors appropriately

## 7. Data Consistency Improvements

### User References
- All `assignedTo` and `reporter` fields now store user IDs (ObjectId)
- User details are populated in responses (name, email)
- Frontend should send user IDs, not names or emails

### Project References
- `projectId` field in tasks is now standardized to ObjectId
- Backend handles both string and ObjectId formats for backward compatibility

**Frontend Implementation:**
- Ensure all user selection dropdowns use user IDs
- Update task forms to send user IDs only
- Display populated user information in task lists

## 8. Performance Optimizations

### Dashboard Optimization
- Use the new `/api/dashboard/summary` endpoint instead of multiple API calls
- This reduces dashboard load time significantly

### Project Tasks
- Use `/api/projects/{projectId}/tasks` for project-specific task lists
- This provides better performance than filtering all tasks

**Frontend Implementation:**
- Replace multiple dashboard API calls with single summary call
- Implement project-specific task loading
- Add loading states for better UX

## 9. Authentication & Permissions

### Role-Based Access
- Project creators and admins can manage team members
- Regular users can view projects they're assigned to
- Enhanced permission checks for all operations

**Frontend Implementation:**
- Implement role-based UI components
- Show/hide management options based on user permissions
- Add proper authorization headers to all API calls

## 10. Migration Notes

### Backward Compatibility
- Existing data has been migrated to new formats
- API endpoints maintain backward compatibility where possible
- New features are additive and don't break existing functionality

**Frontend Implementation:**
- No breaking changes to existing functionality
- New features can be implemented incrementally
- Test thoroughly with existing data

## Summary of Key Changes

1. **New Dashboard Summary API** - Single endpoint for all dashboard data
2. **Enhanced Project Management** - Team member management with role-based permissions
3. **New Project Tasks Endpoint** - Get tasks for specific projects
4. **Auto-generated Task IDs** - Backend handles task ID generation
5. **Consistent User References** - All user fields use ObjectId with populated details
6. **Improved Error Handling** - Standardized error responses across all endpoints
7. **Performance Optimizations** - Reduced API calls and optimized queries
8. **Enhanced Security** - Role-based permissions and validation

## Testing Recommendations

1. Test all new endpoints with proper authentication
2. Verify team member management functionality
3. Test task creation without providing ID field
4. Verify project-specific task loading
5. Test dashboard summary endpoint
6. Verify error handling for all scenarios
7. Test role-based permissions
8. Verify data consistency across all operations

## Priority Implementation Order

1. **High Priority:** Dashboard summary API, task operations using `_id`
2. **Medium Priority:** Team member management, project tasks endpoint
3. **Low Priority:** Enhanced error handling, performance optimizations

This comprehensive update provides a robust, scalable, and user-friendly project management system with proper data consistency and performance optimizations.
